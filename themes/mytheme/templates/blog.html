{# Blog feed page: single-column feed, sidebar, search #}
{% extends "base.html" %}
{% block content %}
<div class="blog-page">
  <div class="feed">
    {% for article in articles %}
    {# Data attributes carry the logic for search.js #}
    <article class="post-card" 
             data-tags="{% for t in article.tags %}{{ t|lower }},{% endfor %}"
             data-category="{{ article.category|lower if article.category else '' }}"
             data-search="{{ article.title|lower }} {{ article.summary|lower }} {{ article.category|lower if article.category else '' }}">
             
      <div style="display:flex; align-items:flex-start; gap:1rem; width:100%;">
        {% if article.metadata.get('image') %}
        <img class="thumb" src="{{ SITEURL }}/{{ article.metadata.get('image') }}" alt="{{ article.title }}">
        {% endif %}
        <div style="flex:1; min-width:0;">
          <header class="post-head">
            <h2 class="post-title"><a href="{{ SITEURL }}{{ article.url }}">{{ article.title }}</a></h2>
            <div class="meta">{{ article.date.strftime('%Y-%m-%d') }} • {{ article.author }}</div>
          </header>
          <div class="post-summary">{{ article.summary }}</div>
          <p class="read-more"><a href="{{ SITEURL }}{{ article.url }}">Read →</a></p>
        </div>
      </div>
    </article>
    {% endfor %}
    
    <div class="no-results" style="display: none;">
      <p>No posts found matching your criteria.</p>
      <button class="btn btn-ghost" style="margin-top:1rem">Show all posts</button>
    </div>
  </div>
  
  <aside class="sidebar">
    <div class="sidebar-widget-group">
      <div class="search-box widget">
        <input type="text" id="search-input" placeholder="Search posts..." autocomplete="off" />
        <button type="button" id="clear-search" class="search-clear" aria-label="Clear search" style="display: none;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <div class="widget">
        <h3>Categories</h3>
        <ul class="categories-list">
          {# "All" Button #}
          <li><button type="button" class="cat-badge category-filter active" data-filter="all">All</button></li>
          
          {% set seen_cats = [] %}
          {% for a in articles %}
            {% if a.category and a.category not in seen_cats %}
              {% set _ = seen_cats.append(a.category) %}
              <li>
                <button type="button" class="cat-badge category-filter" data-filter="{{ a.category|lower }}">{{ a.category }}</button>
              </li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>

      <div class="widget">
        <h3>Tags</h3>
        <ul class="categories-list">
          {% set seen_tags = [] %}
          {% for a in articles %}
            {% for t in a.tags %}
              {% if t not in seen_tags %}
                {% set _ = seen_tags.append(t) %}
                <li>
                  {# Using tag-filter class for JS selector #}
                  <button type="button" class="cat-badge tag-filter" data-tag="{{ t|lower }}">{{ t }}</button>
                </li>
              {% endif %}
            {% endfor %}
          {% endfor %}
        </ul>
      </div>

    </div>
  </aside>
</div>

{# Link the modular JS file #}
<script src="{{ SITEURL }}/theme/js/search.js"></script>
{% endblock %}